# State Space Model

## State Space Linear Model

비선형 소자가 들어있지 않은, 그러나 L혹은 C가 들어있는 전기회로는 전류 혹은 전압값을 상태 변수 (State variable)로 놓고 이들 값이 시간에 따라 변화하는 것을 나타내는 state space model을 유도하여 system을 분석할 수 있다.

수식은 따라서 다음과 같은 미분 방정식의 꼴을 갖는다.

$$ \dot{\bf x} = {\bf Mx} + {\bf Nu} $$

이것을 Trapezoidal rule을 이용하여 discrete signal에 대해서 바꿔 보면, 다음과 같아진다.

$$ {\bf x}(n) = {\bf Ax}(n-1) + {\bf Bu}(n) $$

즉, 현재의 상태 변수는 과거의 상태변수와 현재의 입력으로 결정되는 것이다.

이 시스템에서의 출력 또한 다음과 같아진다.
$$ {\bf y}(n) = {\bf Cx}(n-1) + {\bf Du}(n) $$

Discrete model을 블록 다이어그램으로 나타내면 다음과 같아진다.

![](https://raw.githubusercontent.com/uberschall/test/master/guitar_amplifier_simulation/model1.png)

## State Space Non-Linear Model

Diode clipper라든가 Triode가 들어가 있는 비선형회로는 기존의 state space model에 비선형 함수를 통해 그 왜곡을 추가하여 나타낼 수 있다.

$$ {\bf x}(n) = {\bf Ax}(n-1) + {\bf Bu}(n)  + {\bf Ci}(n) $$
$$ {\bf i}(n) = {\bf f}({\bf p}(n)) $$
$$ {\bf p}(n) = {\bf Dx}(n-1) + {\bf Eu}(n) $$

여기서,

$$ {\bf x}(n)$$: 현재의 상태변수 벡터를 의미하며, 각 element는 회로상의 전압 혹은 전류 기억 소자 (C 또는 L)가 가지고 있는 전압 혹은 전류값이 된다.

$$ {\bf p}(n)$$: 비 선형 소자를 모델링하는 모델 함수의 종속 변수를 의미한다. 진공관 모델의 경우 단자간 전압을 의미한다.

$$ {\bf i}(n)$$: 비 선형 소자의 출력값을 의미하며, TR이나 진공관 모델의 경우 각 단자를 통해 들고 나오는 전류값이 된다.

$$ {\bf  u}(n)$$: 회로 모델의 입력 벡터이다. 진공관 증폭단을 예로 들면 회로의 입력 전압, 공급 전압이 된다.


이러한 방법을 David T. Yeh라는 이가 수식으로 정리하여 그 자신의 논문을 통해 발표하였는데, DK method (Discrete K-method)라고 이름 짓고, 비선형 아날로그 회로를 행렬로 분석할 수 있도록 하였다. 이는 새로운 발견이라고 보긴 어렵고, 비선형 아날로그 회로 (복잡하면 안됨)를 기존의 state space model에 적용한 응용 예라고 보면 된다.

이 과정은 다시 풀어 정리하면

    1) 과거 상태 변수를 바탕으로 새로운 입력의 영향을 적용시켜 비선형 함수의 입력을 계산한다.
    2) 비선형 함수를 통해 비선형 소자의 왜곡을 계산한다.
    3) 과거 상태 변수에 새로운 입력, 그리고 비선형 소자의 왜곡을 한꺼번에 반영하여 새로운 상태변수를 얻는다.

위 과정을 매 sampling interval에 대해서 수행해야 하므로, 연산과정을 최적화 (SSE등을 활용)하거나 단순화시켜야 실시간 플러그인으로 구현이 가능하다.

장단점을 들라면,

장점 1. Spice에서 회로를 분석하는 방법과 가장 가깝게 시뮬레이션 할 수 있다. (정확도 면에서는 다소 차이가 있을 수 있다) 따라서, S/W 모델링에서 이보다 더 정확도가 높은 방법은 있을 수가 없다.

장점 2. 행렬을 이용하므로 큰 틀을 유지하기만 하면 다양한 변종 회로에 대해서도 큰 변경 없이 적용이 가능하다.

단점 1. 실시간 시뮬레이션으로 활용하기엔 아직도 느리다. (저자들도 스스로 인정함)

단점 2. 직관적이지 못하다. 회로의 형태가 변화하면 이것을 전부 새로운 행렬식으로 유도하는 수고가 엄청나다.



